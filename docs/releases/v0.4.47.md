# Release v0.4.47 - Multi-Agent Configuration Support

**Release Date:** February 4, 2026

## Overview

This release introduces **multi-agent configuration support**, making it easier to set up db-mcp across different MCP-compatible AI agents. Instead of manually editing JSON/TOML config files, you can now configure db-mcp for Claude Desktop, Claude Code, and OpenAI Codex with a single command.

## Highlights

### Automatic Agent Detection & Configuration

db-mcp now automatically detects which MCP-compatible agents are installed on your system and offers to configure them all at once:

```bash
db-mcp init mydb
# Detects: Claude Desktop [yes], Claude Code [yes], OpenAI Codex [no]
# Prompts: Configure db-mcp for which agents?
#   [1] All detected agents  ← default
#   [2] Select specific agents
#   [3] Skip agent configuration
```

### New `db-mcp agents` Command

Manage agent configurations anytime with the new dedicated command:

```bash
# Interactive selection
db-mcp agents

# List detected agents
db-mcp agents --list

# Configure all detected agents
db-mcp agents --all

# Configure specific agents
db-mcp agents -A claude-desktop
db-mcp agents -A claude-code -A codex
```

## New Features

### 1. Multi-Agent Registry

A centralized agent registry with auto-detection for:

| Agent | Config Location | Format | Detection Method |
|-------|----------------|--------|------------------|
| **Claude Desktop** | `~/Library/Application Support/Claude/claude_desktop_config.json` | JSON | Config file or app presence |
| **Claude Code** | `~/.claude.json` | JSON | Config file or `claude` CLI |
| **OpenAI Codex** | `~/.codex/config.toml` | TOML | Config directory or `codex` CLI |

### 2. Intelligent Configuration

- **Preserves existing servers**: Only adds/updates the `db-mcp` entry, keeps all other MCP servers intact
- **Legacy cleanup**: Automatically removes old `dbmeta` entries
- **Cross-platform**: Works on macOS, Windows, and Linux

### 3. Flexible TOML Support

- Uses Python's built-in `tomllib` for reading TOML (Python 3.11+)
- Custom TOML writer implementation (no external dependencies)
- Full support for OpenAI Codex's config format

## Usage Examples

### First-Time Setup

```bash
# Initialize a new connection
db-mcp init production

# db-mcp detects installed agents and prompts:
# Detected MCP-compatible agents:
#   [1] Claude Desktop
#   [2] Claude Code
#
# Configure db-mcp for which agents?
# Choice [1]: ← press Enter to configure all
#
# [yes] Claude Desktop configured
# [yes] Claude Code configured
# [yes] Configured 2/2 agent(s)
```

### Reconfigure Agents Later

```bash
# List what's installed
db-mcp agents --list
# Detected MCP agents:
#   [yes] Claude Desktop
#     Config: ~/Library/Application Support/Claude/claude_desktop_config.json
#   [yes] Claude Code
#     Config: ~/.claude.json

# Configure all detected agents
db-mcp agents --all
# [yes] Claude Desktop configured
# [yes] Claude Code configured
# [yes] Configured 2/2 agent(s)
```

### Configure Specific Agents

```bash
# Only configure Claude Desktop
db-mcp agents -A claude-desktop

# Configure multiple specific agents
db-mcp agents -A claude-code -A codex
```

## Technical Details

### Agent Detection Logic

1. **Config File Check**: Looks for agent config files in standard locations
2. **App/CLI Check**: Falls back to checking if app is installed or CLI is available
3. **Platform-Aware**: Adjusts paths based on OS (macOS/Windows/Linux)

### Configuration Process

For each agent:

1. Load existing config (if any)
2. Add/update `db-mcp` server entry with correct binary path
3. Remove legacy `dbmeta` entry (if present)
4. Save config while preserving all other servers

### Config Format Examples

**Claude Desktop/Code (JSON)**:
```json
{
  "mcpServers": {
    "db-mcp": {
      "command": "/usr/local/bin/db-mcp",
      "args": ["start"]
    }
  }
}
```

**OpenAI Codex (TOML)**:
```toml
[mcp_servers.db-mcp]
command = "/usr/local/bin/db-mcp"
args = ["start"]
```

## Testing

This release includes comprehensive test coverage:

- **21 new tests** for agent detection, configuration, and TOML handling
- All tests passing [ok]
- No regressions in existing functionality

## Important Notes

### ChatGPT Desktop Not Supported

ChatGPT Desktop uses UI-only configuration (Settings → Connectors → Developer mode) and does not support local config file configuration. You'll need to configure it manually through the UI.

### Binary Path Detection

db-mcp intelligently detects the binary path:
- If running from PyInstaller bundle: uses the executable path
- If symlinked at `~/.local/bin/db-mcp`: uses the symlink (for auto-updates)
- Otherwise: uses `db-mcp` command

## Upgrade Instructions

### From v0.4.45

1. Update to v0.4.47:
   ```bash
   # If installed via pip
   pip install --upgrade db-mcp
   
   # If using binary
   # Download new binary and replace existing one
   ```

2. Reconfigure agents (optional but recommended):
   ```bash
   db-mcp agents --all
   ```

3. Restart your MCP agents (Claude Desktop, Claude Code, etc.)

## Bug Fixes

- None (feature-only release)

## Security

- No security changes in this release

## Documentation Updates

- Added agent registry documentation
- Updated CLI command reference
- Added multi-agent setup examples

## Credits

This feature was developed in response to user feedback requesting easier configuration across multiple AI agents.

## Full Changelog

See [CHANGELOG.md](../../CHANGELOG.md#0446---2026-02-04) for complete details.

## Coming Soon

Stay tuned for upcoming features:
- Additional agent support (Cursor, Windsurf, etc.)
- Config validation and health checks
- Agent-specific settings and preferences

---

**Questions or Issues?** Report them at https://github.com/apelogic-ai/db-mcp/issues
