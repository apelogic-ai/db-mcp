# db-mcp v0.5.0

## Highlights

### Multi-Connection Support

db-mcp is no longer limited to one database connection per server. Query any connection by name, see all available schemas, and let the agent reason across multiple data sources.

**Connection Registry:**
- Automatic discovery of all connections in `~/.db-mcp/connections/`
- Lazy-loading and caching of connectors
- `list_connections` tool shows all available connections with type, dialect, and description

**`connection` parameter on tools:**
All query tools now accept an optional `connection` parameter:
```
run_sql(sql="SELECT ...", connection="warehouse")
list_tables(connection="analytics")
describe_table(table="orders", connection="postgres")
```

When omitted, tools use the default connection (backward compatible).

**Tools with connection parameter:**
- `run_sql`, `validate_sql`, `export_results`
- `list_catalogs`, `list_schemas`, `list_tables`, `describe_table`, `sample_table`
- `shell` (sets working directory to the connection's vault)

**MCP Resources:**
- `db-mcp://connections` — lists all available connections with metadata
- `db-mcp://schema/{connection}` — returns schema for any connection

**PROTOCOL.md:**
Updated template includes multi-connection guidance, instructing the agent to use `list_connections` and the `connection` parameter for cross-source queries.

## Breaking changes
- None. Single-connection users are unaffected.

## Features
- Connection registry with auto-discovery, lazy-loading, and caching
- `list_connections` tool
- `connection` parameter on all SQL/query/shell tools
- `db-mcp://connections` resource
- `db-mcp://schema/{connection}` resource
- PROTOCOL.md multi-connection queries section

## Fixes
- None

## Test Coverage
- 38 new tests (18 registry + 13 multi-connection + 7 multi-schema resource)
- Full suite: 570 tests passing

## Upgrade notes
- PROTOCOL.md will be updated on next vault init with multi-connection guidance
- Existing connections work unchanged; no migration needed
- To use multi-connection: ensure multiple connections exist in `~/.db-mcp/connections/`
